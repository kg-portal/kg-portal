{% extends "base.html" %}

{% block content %}

<style>
    @keyframes marqueeOnce {
        0% { transform: translateX(100%); }
        100% { transform: translateX(0%); }
    }

    /* DIÅž PANEL: MÃœKEMMEL MAVÄ° GEÃ‡Ä°ÅžLÄ° */
    .module-container {
        background: linear-gradient(135deg, #1e40af, #3b82f6); 
        border: none;
        border-radius: 24px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        box-shadow: 0 10px 25px rgba(30, 64, 175, 0.3);
    }

    /* Ä°Ã‡ KUTULAR: BEYAZ */
    .kpi-card {
        background: #ffffff;
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: #111827;
        border-radius: 20px;
        padding: 22px;
        height: 140px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .kpi-card.blue-active {
        background: #ffffff !important;
        border: 3px solid #1e40af !important;
    }

    .card-label { color: #64748b; font-size: 18px; font-weight: 600; }
    .card-value { font-size: 26px; font-weight: 800; margin-top: 8px; color: #1e40af; } 

    .chart-box {
        background: #ffffff;
        border-radius: 20px;
        padding: 20px;
        box-sizing: border-box;
        width: 100%;
    }

    .chart-title { font-size: 16px; font-weight: 800; color: #1e40af; margin-bottom: 15px; } 
    canvas { width: 100% !important; height: 180px !important; }

    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
    }

    /* TO-DO Ã–ZEL STÄ°LLERÄ° */
    .todo-input-group { display: flex; gap: 5px; margin-top: 5px; }
    .todo-input { border: 1px solid #e5e7eb; border-radius: 8px; padding: 5px; flex-grow: 1; font-size: 14px; }
    .todo-add-btn { background: #1e40af; color: white; border: none; border-radius: 8px; padding: 5px 12px; cursor: pointer; font-weight: bold; }
    .todo-list { margin-top: 10px; max-height: 50px; overflow-y: auto; list-style: none; padding: 0; font-size: 13px; font-weight: 700; color: #111827; }
    .todo-item { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
</style>

<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
    <div style="overflow: hidden; white-space: nowrap; flex-grow: 1;">
        <div style="display: inline-block; animation: marqueeOnce 5s ease-out forwards; color: #1e40af; font-size: 24px; font-weight: 700;">
            Willkommen bei KG-GebÃ¤udereinigung
        </div>
    </div>

    <div style="text-align: right; font-family: sans-serif; min-width: 180px;">
        <div id="digital-clock" style="font-size: 18px; font-weight: 800; line-height: 1.4; color: #1e40af;">00:00</div>
        <div id="current-date" style="font-size: 18px; font-weight: 700; line-height: 1.4; color: #000000;">Duisburg, --.--.----</div>
        <div style="font-size: 18px; font-weight: 700; line-height: 1.4; color: #000000;">
            Wetter: <span id="weather-desc">Laden...</span> <span id="weather-temp"></span>
        </div>
        <div id="weather-icon" style="font-size: 45px; margin-top: 5px; line-height: 1;"></div>
    </div>
</div>

<h1 style="font-size:28px; font-weight:800; margin-bottom:6px;">LeistungsÃ¼bersicht</h1>
<div style="color:#64748b; font-weight: 600; margin-bottom:30px;">Aktueller Status Â· Fortschritt & Ergebnisse</div>

<div class="dashboard-grid">
    <div class="module-container">
        <div class="kpi-card blue-active" onclick="setActive(this)"><div class="card-label">Monatlicher Umsatz</div><div class="card-value">10.000,00 â‚¬</div></div>
        <div class="chart-box"><div class="chart-title">Monatstrend</div><canvas id="monthlyTrendChart"></canvas></div>
    </div>

    <div class="module-container">
        <div class="kpi-card" onclick="setActive(this)"><div class="card-label">Aktueller Gesamtumsatz</div><div class="card-value">145.500,00 â‚¬</div></div>
        <div class="chart-box"><div class="chart-title">JahresÃ¼bersicht 2026</div><canvas id="yearlyOverviewChart"></canvas></div>
    </div>

    <div class="module-container">
        <div class="kpi-card" onclick="setActive(this)">
            <div class="card-label">Buchhaltung</div>
            <div style="display: flex; flex-direction: column; margin-top: 5px; font-size: 16px; font-weight: 800;">
                <div style="color: #1e40af;">Einnahmen: 10.000 â‚¬</div>
                <div style="color: #dc2626;">Ausgaben: 0 â‚¬</div>
            </div>
        </div>
        <div class="chart-box">
            <div class="chart-title">Bilanz Ãœbersicht 2026</div>
            <canvas id="chart8"></canvas>
        </div>
    </div>

    <div class="module-container">
        <div class="kpi-card" onclick="setActive(this)">
            <div class="card-label">To-Do Liste</div>
            <div class="todo-input-group">
                <input type="text" id="todoInput" class="todo-input" placeholder="Aufgabe hinzufÃ¼gen...">
                <button onclick="addTodo()" class="todo-add-btn">+</button>
            </div>
            <ul id="todoList" class="todo-list"></ul>
        </div>
        <div class="chart-box">
            <div class="chart-title">Status: Offen vs Erledigt</div>
            <canvas id="chart7"></canvas>
        </div>
    </div>

    <div class="module-container">
        <div class="kpi-card" onclick="setActive(this)">
            <div class="card-label">Telefonakquise</div>
            <div style="font-size: 18px; color: #1e40af; font-weight: 800; margin-top: 2px;">Anrufe: 0</div>
            <div style="font-size: 14px; color: #64748b; font-weight: 700; margin-top: 2px;">Unternehmensportfolio: 0</div>
            <div style="display: flex; flex-direction: column; margin-top: 5px; font-size: 14px; font-weight: 800;">
                <div style="color: #64748b;">Besichtigungstermine: 0</div>
                <div style="color: #db2777;">VertrÃ¤ge: 0</div>
            </div>
        </div>
        <div class="chart-box">
            <div class="chart-title">Akquise Statistik 2026</div>
            <canvas id="chart6"></canvas>
        </div>
    </div>

    <div class="module-container">
        <div class="kpi-card" onclick="setActive(this)">
            <div class="card-label">Angebot</div>
            <div style="font-size: 18px; color: #1e40af; font-weight: 800; margin-top: 2px;">Gesendet: 0</div>
            <div style="display: flex; flex-direction: column; margin-top: 5px; font-size: 14px; font-weight: 800;">
                <div style="color: #059669;">BestÃ¤tigt: 0</div>
                <div style="color: #6366f1;">Wartend: 0</div> 
                <div style="color: #dc2626;">Nicht bestÃ¤tigt: 0</div>
            </div>
        </div>
        <div class="chart-box"><canvas id="chart5"></canvas></div>
    </div>

    <div class="module-container">
        <div class="kpi-card" onclick="setActive(this)"><div class="card-label">Aktive Kunden</div><div class="card-value">14</div></div>
        <div class="chart-box"><div class="chart-title">KundenÃ¼bersicht 2026</div><canvas id="chart3"></canvas></div>
    </div>

    <div class="module-container">
        <div class="kpi-card" onclick="setActive(this)"><div class="card-label">Aktive Mitarbeiter</div><div class="card-value">28</div></div>
        <div class="chart-box"><div class="chart-title">Personal Statistik 2026</div><canvas id="chart4"></canvas></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    function setActive(element) {
        document.querySelectorAll('.kpi-card').forEach(card => card.classList.remove('blue-active'));
        element.classList.add('blue-active');
    }

    // GRAFÄ°KLER (Verilere dokunulmadÄ±)
    new Chart(document.getElementById('monthlyTrendChart'), { type: 'line', data: { labels: ['Start', 'W1', 'W2', 'W3', 'Aktuell'], datasets: [{ data: [0, 4200, 3800, 7500, 10000], borderColor: '#1e40af', backgroundColor: 'rgba(30, 64, 175, 0.1)', fill: true, tension: 0.4 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });
    new Chart(document.getElementById('yearlyOverviewChart'), { type: 'bar', data: { labels: ['Jan', 'Feb', 'MÃ¤r', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'], datasets: [{ data: [10000, 12000, 11500, 13000, 14500, 12000, 15000, 16000, 14000, 15500, 17000, 18000], backgroundColor: '#1e40af', borderRadius: 5 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });
    new Chart(document.getElementById('chart3'), { type: 'bar', data: { labels: ['Jan', 'Feb', 'MÃ¤r', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'], datasets: [{ data: [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120], backgroundColor: '#059669', borderRadius: 5 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { min: 0, max: 150, ticks: { stepSize: 10 } } } } });
    new Chart(document.getElementById('chart4'), { type: 'bar', data: { labels: ['Jan', 'Feb', 'MÃ¤r', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'], datasets: [{ data: [5, 10, 15, 20, 25, 28, 30, 32, 34, 36, 38, 40], backgroundColor: '#6366f1', borderRadius: 5 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { min: 0, max: 100, ticks: { stepSize: 10 } } } } });
    new Chart(document.getElementById('chart5'), { type: 'doughnut', data: { labels: ['BestÃ¤tigt', 'Wartend', 'Nicht bestÃ¤tigt'], datasets: [{ data: [1, 1, 1], backgroundColor: ['#059669', '#6366f1', '#dc2626'], cutout: '50%' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { boxWidth: 12, font: { size: 10, weight: 'bold' } } } } } });
    new Chart(document.getElementById('chart6'), { type: 'bar', data: { labels: ['Jan', 'Feb', 'MÃ¤r', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'], datasets: [{ data: [20, 45, 30, 60, 80, 50, 90, 110, 70, 100, 120, 140], backgroundColor: '#db2777', borderRadius: 5 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { min: 0, max: 200, ticks: { stepSize: 20 } } } } });

    // TO-DO GRAFÄ°ÄžÄ°
    let todoChart = new Chart(document.getElementById('chart7'), { type: 'doughnut', data: { labels: ['Erledigt', 'Offen'], datasets: [{ data: [0, 1], backgroundColor: ['#059669', '#dc2626'], cutout: '60%' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } } });
    let todos = [];
    function addTodo() { const input = document.getElementById('todoInput'); if (input.value.trim() !== "") { todos.push({ text: input.value, done: false }); input.value = ""; renderTodos(); } }
    function renderTodos() { const list = document.getElementById('todoList'); list.innerHTML = ""; let doneCount = 0; todos.forEach((todo, index) => { const li = document.createElement('li'); li.className = "todo-item"; li.innerHTML = `<input type="checkbox" ${todo.done ? 'checked' : ''} onchange="toggleTodo(${index})"> <span>${todo.text}</span>`; list.appendChild(li); if(todo.done) doneCount++; }); updateTodoChart(doneCount, todos.length - doneCount); }
    function toggleTodo(index) { todos[index].done = !todos[index].done; renderTodos(); }
    function updateTodoChart(done, open) { todoChart.data.datasets[0].data = [done, (open === 0 && done === 0) ? 1 : open]; todoChart.update(); }

    // BUCHHALTUNG GRAFÄ°ÄžÄ°
    new Chart(document.getElementById('chart8'), { type: 'bar', data: { labels: ['Jan', 'Feb', 'MÃ¤r', 'Apr', 'Mai', 'Jun'], datasets: [{ label: 'Einnahmen', data: [10000, 12000, 11000, 13000, 15000, 14000], backgroundColor: '#1e40af' }, { label: 'Ausgaben', data: [7000, 8000, 7500, 9000, 10000, 9500], backgroundColor: '#dc2626' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });

    function updateClock() {
        const now = new Date();
        document.getElementById('digital-clock').textContent = String(now.getHours()).padStart(2, '0') + ":" + String(now.getMinutes()).padStart(2, '0');
        const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
        document.getElementById('current-date').textContent = "Duisburg, " + now.toLocaleDateString('de-DE', options);
    }
    setInterval(updateClock, 1000); updateClock();

    async function fetchWeather() {
        try {
            const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=51.43&longitude=6.76&current_weather=true');
            const data = await response.json();
            const temp = Math.round(data.current_weather.temperature);
            const code = data.current_weather.weathercode;
            let desc = "Klar"; let icon = "â˜€ï¸"; 
            if (code == 0) { desc = "Sonnig"; icon = "â˜€ï¸"; }
            else if (code >= 1 && code <= 3) { desc = "BewÃ¶lkt"; icon = "â˜ï¸"; }
            else if (code >= 51 && code <= 67) { desc = "Regen"; icon = "ðŸŒ§ï¸"; }
            document.getElementById('weather-icon').textContent = icon;
            document.getElementById('weather-desc').textContent = desc;
            document.getElementById('weather-temp').textContent = `${temp}Â°C`;
        } catch (error) { document.getElementById('weather-desc').textContent = "-"; }
    }
    fetchWeather();
</script>

{% endblock %}